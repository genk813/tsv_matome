# TMSONAR表示項目完全対応 - 要件定義書

## はじめに

本プロジェクトは、現在のTMCloudシステムの検索結果表示項目をTMSONAR商標検索データベースの表示項目に完全対応させることを目的としています。

## 現状分析

### TMSONARで表示可能な項目（完全リスト）

TMSONARのヘルプ情報から抽出した表示可能項目：

#### 基本識別情報
1. **INP_NO** - 入力番号（条件入力された番号をそのまま表示）
2. **DSP_NO** - 表示番号（登録番号または出願番号、登録番号優先）
3. **DSP_REG_NO** - 登録番号（国際登録番号含む、マドプロは先頭に「国」）
4. **DSP_APP_NO** - 出願番号（マドプロの場合表示無し）
5. **DSP_REG_NO-REG_DATE** - 登録番号/登録日（2段表示）
6. **DSP_APP_NO-APP_DATE** - 出願番号/出願日（2段表示）

#### 日付情報
7. **REG_DATE** - 登録日（国内登録日）
8. **APP_DATE** - 出願日（マドプロは事後指定日または国際登録日）

#### ステータス・フラグ情報
9. **KENRI_FLG** - 失効フラグ（権利失効データの場合「※」表示）
10. **REG_FLG** - 登録フラグ（登録済の場合「登」表示）
11. **MAD_FLG** - マドプロフラグ（マドプロデータの場合「国」表示）

#### 商標情報
12. **TMARK** - 商標（表示用商標）
13. **LSTIMG** - イメージ（商標見本部イメージ、複数の場合1枚目のみ）
14. **SHOKO** - 称呼（特許庁称呼）
15. **TMARK_TYPE** - 商標タイプ（立体、音、動き、ホログラム、色彩のみ、位置）
16. **SHOSAI_SETSUMEI** - 商標の詳細な説明（一覧127文字、CSV4000バイト）

#### 出願・法区分情報
17. **APP_KIND** - 出願種別（通常、連合、防護、分割、補却、変更、優先、団体、地域、特例）
18. **ADD_INFO** - 付加情報（色彩、図形、５４、３２、標準、９１、重複、権不、同否、同是）
19. **HO_KBN** - 法区分コード（U,V,W,X,Y,Z,0-4）
20. **HO_KBN_KIJI** - 法区分記事（法区分の日本語表示）
21. **CLASS** - 分類（法区分に対応した分類）
22. **CLASS_NUM** - 区分数（法区分に対応した分類の個数）

#### 人名・住所情報
23. **KENRI_NAME** - 出願人/権利者
24. **KENRI_ADDRESS** - 出願人/権利者住所
25. **KENRI_NUM** - 出願人/権利者数（共願の数）
26. **DAIRI_NAME** - 代理人（マドプロの場合は国内代理人）
27. **KUNI_CODE** - 国県コード（出願人/権利者、マドプロは本国官庁コード）
28. **KUNI_KIJI** - 国県名（国県コードに対応した国県名）

#### 期限・満了日情報
29. **FINAL_DATE-BUN_DATE** - 存続満了日/分納満了日（2段表示、「満」「分」付加）

#### 経過・記録情報
30. **PRGRS_REC** - 中間記録（一覧5行、CSV4000バイト）
31. **SSJ_CODE** - 審査条文コード（カーソルで対応内容表示）
32. **SSJ_KIJI** - 審査条文記事（審査条文コードの内容）
33. **SPJ_CODE** - 審判条文コード（カーソルで対応内容表示）
34. **SPJ_KIJI** - 審判条文記事（審判条文コードの内容）
35. **APPL_NO** - 審判番号
36. **APPL_NO_UMU** - 審判有無（審判有の場合「有」表示）
37. **SB_CODE** - 最終処分コード
38. **SB_KIJI** - 最終処分記事（最終処分内容）

#### 商品・分類情報
39. **RUIJIGUN** - 類似群コード（最大42個、43個以上は「...」付加）
40. **SHOHIN_NAME** - 指定商品/役務名（分類+商品役務名、127文字制限）
41. **FIGTERM** - ウィーン図形分類（ウィーンコードのみ）
42. **FIGTERM_KIJI** - ウィーン図形分類記事（コード+説明、図形検索ダウンロードのみ）

#### 外部リンク
43. **JPP_URL** - J-PlatPat商標照会（INPITのJ-PlatPatへリンク）

### 現在のTMCloudプロジェクトで表示可能な項目

現在の`_format_unified_result`関数で返される項目：

#### 基本情報（basic_info）
1. **app_num** - 出願番号（内部処理用）
2. **display_number** - 表示用番号（マドプロなら国際登録番号）
3. **is_madrid** - マドプロ案件フラグ
4. **intl_reg_num** - 国際登録番号
5. **intl_reg_date** - 国際登録日
6. **app_date** - 出願日
7. **reg_num** - 登録番号
8. **reg_date** - 登録日
9. **trademark_name** - 商標名
10. **trademark_image_data** - 商標画像データ（Base64）
11. **phonetics** - 称呼（配列）
12. **applicants** - 出願人（配列）
13. **applicant_addresses** - 出願人住所（配列）
14. **applicant_country_codes** - 出願人国県コード（配列）
15. **agents** - 代理人（配列）
16. **right_holders** - 権利者（配列）
17. **classes** - 区分（配列）
18. **goods_services** - 指定商品/役務（区分別辞書）
19. **similar_groups** - 類似群コード（区分別辞書）
20. **vienna_codes** - ウィーンコード（配列）
21. **rejection_codes** - 拒絶理由コード（配列、日本語変換済み）
22. **latest_rejection_date** - 最新拒絶理由通知日
23. **final_disposition_type** - 最終処分種別（日本語変換済み）
24. **final_disposition_date** - 最終処分日
25. **final_disposition_article** - 最終処分記事（日本語）
26. **reg_article_gazette_date** - 登録公報発行日
27. **pub_article_gazette_date** - 公開公報発行日
28. **conti_prd_expire_date** - 存続期間満了日
29. **next_pen_payment_limit_date** - 次回分納期限日
30. **app_type1-5** - 出願種別1-5（日本語変換済み）
31. **orig_app_type** - 元出願種別（日本語変換済み）
32. **article3_2_flag** - 3条2項適用フラグ
33. **article5_4_flag** - 5条4項適用フラグ
34. **exam_type** - 審査種別（日本語変換済み）
35. **decision_type** - 査定種別（日本語変換済み）
36. **applicable_law_class** - 適用法区分（日本語変換済み）
37. **trademark_type** - 商標タイプ
38. **defensive_mark_info** - 防護標章情報（構造化）
39. **prior_app_right_occr_dt** - 先願権発生日
40. **renewal_reg_num** - 更新登録番号
41. **detailed_description** - 商標の詳細な説明
42. **appeal_nums** - 審判番号（配列）
43. **appeal_types** - 審判種別（配列、日本語変換済み）
44. **progress_records** - 中間記録（構造化、分類済み）
45. **priority_claims** - 優先権情報（構造化）
46. **oppositions** - 異議申立情報（構造化）
47. **transfers** - 移転受付情報（構造化）
48. **madrid_priority_countries** - マドプロ優先権国（配列）
49. **madrid_priority_numbers** - マドプロ優先権番号（配列）
50. **madrid_priority_dates** - マドプロ優先権日（配列）

## 要件

### 要件1: TMSONAR表示項目の完全対応

**ユーザーストーリー:** 商標調査担当者として、TMSONARと同等の43種類の表示項目を確認して、包括的な商標情報を把握したい。

#### 受入基準

1. WHEN 検索結果が表示される THEN システムは以下の基本識別情報を表示する
   - 入力番号（検索条件として入力された番号）
   - 表示番号（登録番号優先、分割番号はハイフン連結、防護番号は括弧付き）
   - 登録番号（国際登録番号含む、マドプロは「国」プレフィックス）
   - 出願番号（マドプロの場合は非表示）
   - 登録番号/登録日の2段表示オプション
   - 出願番号/出願日の2段表示オプション

2. WHEN 検索結果が表示される THEN システムは以下のステータス・フラグ情報を表示する
   - 権利失効フラグ（失効データは「※」表示）
   - 登録フラグ（登録済みは「登」表示）
   - マドプロフラグ（マドプロデータは「国」表示）

3. WHEN 検索結果が表示される THEN システムは以下の商標情報を表示する
   - 表示用商標
   - 商標見本部イメージ（複数の場合1枚目のみ）
   - 特許庁称呼
   - 商標タイプ（立体、音、動き、ホログラム、色彩のみ、位置）
   - 商標の詳細な説明（一覧127文字制限、エクスポート4000バイト制限）

4. WHEN 検索結果が表示される THEN システムは以下の出願・法区分情報を表示する
   - 出願種別（通常、連合、防護、分割、補却、変更、優先、団体、地域、特例）
   - 付加情報（色彩、図形、５４、３２、標準、９１、重複、権不、同否、同是）
   - 法区分コード（U,V,W,X,Y,Z,0-4）
   - 法区分記事（法区分の日本語表示）
   - 分類（法区分に対応した分類）
   - 区分数（法区分に対応した分類の個数）

5. WHEN 検索結果が表示される THEN システムは以下の人名・住所情報を表示する
   - 出願人/権利者
   - 出願人/権利者住所
   - 出願人/権利者数（共願の数）
   - 代理人（マドプロの場合は国内代理人）
   - 国県コード（出願人/権利者、マドプロは本国官庁コード）
   - 国県名（国県コードに対応した国県名）

### 要件2: 表示項目のカスタマイズ機能

**ユーザーストーリー:** 商標調査担当者として、調査目的に応じて表示項目を選択・カスタマイズして、効率的に情報を確認したい。

#### 受入基準

1. WHEN ユーザーが表示設定画面を開く THEN 43種類の表示項目から任意の項目を選択できる

2. WHEN ユーザーが表示項目を選択する THEN 選択した項目のみが検索結果に表示される

3. WHEN ユーザーが表示設定を保存する THEN 設定がプロファイルとして保存され、次回検索時に適用される

4. WHEN ユーザーが表示項目を並び替える THEN ドラッグ&ドロップで表示順序を変更できる

### 要件3: 表示形式の最適化

**ユーザーストーリー:** 商標調査担当者として、TMSONARと同等の見やすい表示形式で情報を確認したい。

#### 受入基準

1. WHEN 長いテキスト項目が表示される THEN 一覧表示では文字数制限を適用し、詳細表示では全文を表示する
   - 商標の詳細な説明: 一覧127文字、詳細/エクスポート4000バイト
   - 指定商品/役務名: 一覧127文字、詳細/エクスポート制限なし
   - 中間記録: 一覧最新5行、詳細/エクスポート4000バイト

2. WHEN 複数値項目が表示される THEN 適切な区切り文字で表示する
   - 類似群コード: 最大42個表示、43個以上は「...」付加
   - 称呼: カンマ区切り
   - 出願人/権利者: カンマ区切り

3. WHEN 2段表示項目が選択される THEN 上下2段で関連情報を表示する
   - 登録番号/登録日
   - 出願番号/出願日
   - 存続満了日/分納満了日（「満」「分」プレフィックス付き）

### 要件4: コードマッピングの完全実装

**ユーザーストーリー:** 商標調査担当者として、コード値ではなく意味のある日本語表示で情報を確認したい。

#### 受入基準

1. WHEN 審査条文コードが表示される THEN 対応する条文内容が表示される

2. WHEN 審判条文コードが表示される THEN 対応する条文内容が表示される

3. WHEN 最終処分コードが表示される THEN 対応する処分内容が表示される

4. WHEN 法区分コードが表示される THEN 対応する法区分名が表示される

5. WHEN 国県コードが表示される THEN 対応する国県名が表示される

### 要件5: エクスポート機能の拡張

**ユーザーストーリー:** 商標調査担当者として、TMSONARと同等のエクスポート機能を使用して、調査結果を外部で活用したい。

#### 受入基準

1. WHEN ユーザーがエクスポートを実行する THEN Excel形式とCSV形式を選択できる

2. WHEN エクスポートが実行される THEN 選択された表示項目のみがエクスポートされる

3. WHEN エクスポートが実行される THEN 文字数制限が拡張される
   - 商標の詳細な説明: 4000バイトまで
   - 中間記録: 4000バイトまで

4. WHEN ウィーン図形分類がエクスポートされる THEN コード+説明の両方が出力される

### 要件6: パフォーマンスの維持

**ユーザーストーリー:** システム管理者として、表示項目の拡張によってもレスポンス性能を維持したい。

#### 受入基準

1. WHEN 全43項目が選択される THEN 検索レスポンス時間は10秒以内を維持する

2. WHEN 大量データ（1000件以上）が表示される THEN ページング機能により快適な操作性を提供する

3. WHEN 画像データが含まれる THEN 遅延読み込みにより初期表示を高速化する

4. WHEN エクスポートが実行される THEN バックグラウンド処理により画面操作を阻害しない

## 不足項目の特定

### TMSONARにあって現在のTMCloudにない項目

1. **入力番号** - 検索条件として入力された番号の表示
2. **権利失効フラグ** - 失効データの「※」表示
3. **登録フラグ** - 登録済みデータの「登」表示
4. **2段表示オプション** - 番号/日付、存続満了日/分納満了日の2段表示
5. **法区分コード・記事** - 法区分の表示（U,V,W,X,Y,Z,0-4とその日本語）
6. **審査条文コード・記事** - 審査条文の表示
7. **審判条文コード・記事** - 審判条文の表示
8. **審判有無フラグ** - 審判有の場合の「有」表示
9. **付加情報の詳細表示** - 色彩、図形、標準文字等の詳細フラグ
10. **国県名表示** - 国県コードに対応した日本語名
11. **文字数制限の実装** - 一覧表示での127文字制限
12. **類似群コード制限** - 42個制限と「...」表示
13. **ウィーン図形分類記事** - コード+説明の表示
14. **J-PlatPatリンク** - 外部サイトへのリンク機能

### 現在のTMCloudにあってTMSONARにない項目

1. **マドプロ関連の詳細情報** - 国際登録日、マドプロ優先権情報
2. **防護標章の詳細情報** - 構造化された防護標章情報
3. **異議申立情報** - 詳細な異議申立データ
4. **移転受付情報** - 詳細な移転データ
5. **中間記録の分類表示** - 審査・審判・登録別の分類
6. **優先権情報の詳細** - 構造化された優先権データ
7. **画像データのBase64表示** - 直接的な画像表示機能

## 実装優先度

### 高優先度（Phase 1）
- 基本識別情報の完全対応
- ステータス・フラグ情報の実装
- 文字数制限の実装
- コードマッピングの完全実装

### 中優先度（Phase 2）
- 表示項目カスタマイズ機能
- 2段表示オプション
- エクスポート機能の拡張

### 低優先度（Phase 3）
- J-PlatPatリンク機能
- 高度な表示設定機能
- パフォーマンス最適化